L.GeoJSON.AJAX=L.GeoJSON.extend({defaultAJAXparams:{dataType:"json",callbackParam:"callback",middleware:function(e){return e}},initialize:function(e,t){if(e&&typeof e!=="string"){t=e;e=undefined}var a=L.Util.extend({},this.defaultAJAXparams);for(var r in t){if(this.defaultAJAXparams.hasOwnProperty(r)){a[r]=t[r]}}this.ajaxParams=a;this._layers={};L.Util.setOptions(this,t);if(e){this.addUrl(e)}},clearLayers:function(){this._url=undefined;this.off("dataloadInt");L.GeoJSON.prototype.clearLayers.call(this);return this},addUrl:function(e){var t=this;t._url=e;t.on("dataloadInt",function(e){t.addData(e.data);if(this._filter){this.refilter(this._filter)}this.fire("data:loaded")},t);t.fire("data:loading");if(t.ajaxParams.dataType.toLowerCase()==="json"){L.Util.ajax(e,function(e){t.fire("dataloadInt",{data:t.ajaxParams.middleware(e)})})}else if(t.ajaxParams.dataType.toLowerCase()==="jsonp"){L.Util.ajax(e,{jsonp:true},function(e){t.fire("dataloadInt",{data:t.ajaxParams.middleware(e)})},t.ajaxParams.callbackParam)}},refresh:function(e){e=e||this._url;this.clearLayers();this.addUrl(e)},refilter:function(e){if(typeof e!=="function"){this._filter=false;this.eachLayer(function(e){e.setStyle({stroke:true,clickable:true})})}else{this._filter=e;this.eachLayer(function(t){if(e(t.feature)){t.setStyle({stroke:true,clickable:true})}else{t.setStyle({stroke:false,clickable:false})}})}}});L.geoJson.ajax=function(e,t){return new L.GeoJSON.AJAX(e,t)};L.Util.ajax=function(url,options,cb){var cbName,ourl,cbSuffix,scriptNode,head,cbParam,XMHreq;if(typeof options==="function"){cb=options;options={}}if(options.jsonp){head=document.getElementsByTagName("head")[0];cbParam=options.cbParam||"callback";if(options.callbackName){cbName=options.callbackName}else{cbSuffix="_"+(""+Math.random()).slice(2);cbName="L.Util.ajax.cb."+cbSuffix}scriptNode=L.DomUtil.create("script","",head);scriptNode.type="text/javascript";if(cbSuffix){L.Util.ajax.cb[cbSuffix]=function(e){head.removeChild(scriptNode);delete L.Util.ajax.cb[cbSuffix];cb(e)}}if(url.indexOf("?")===-1){ourl=url+"?"+cbParam+"="+cbName}else{ourl=url+"&"+cbParam+"="+cbName}scriptNode.src=ourl;return{abort:function(){return false}}}else{if(window.XMLHttpRequest===undefined){XMHreq=function(){try{return new ActiveXObject("Microsoft.XMLHTTP.6.0")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP.3.0")}catch(t){throw new Error("XMLHttpRequest is not supported")}}}}else{XMHreq=window.XMLHttpRequest}var response,request=new XMHreq;request.open("GET",url);request.onreadystatechange=function(){if(request.readyState===4&&request.status===200){if(window.JSON){response=JSON.parse(request.responseText)}else{response=eval("("+request.responseText+")")}cb(response)}};request.send();return request}};L.Util.ajax.cb={};